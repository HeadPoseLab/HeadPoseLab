# Data
data_root: ./data
head_dir: head_pose
hand_dir: hand_pose
sequence_length: 16
overlap: true  # use sliding window with stride 1 to enlarge samples
train_ratio: 0.7
val_ratio: 0.15
seed: 42
image_size: 128
hand_roi:
  enabled: true
  expand: 1.6
  min_scale: 0.2

# Dataloader
batch_size: 8
num_workers: 4
sampler:
  balanced: true
  sample_weight_head: 0.3
  sample_weight_hand: 0.7

# Model
model:
  backbone: hybrid_cnn_resnet  # hybrid_cnn_resnet
  resnet_variant: resnet50
  cnn_branch_channels: [32, 64, 128]
  feature_dim: 256             # fused feature dim after CNN+ResNet
  fusion: concat               # concat or sum
  fusion_dropout: 0.1
  shared_backbone: true        # share backbone weights for head/hand streams
  shared_temporal: false       # share temporal encoder for head/hand streams
  adapter:
    enabled: true
    dim: 256
    dropout: 0.1
  num_head_classes: 5
  num_hand_classes: 4          # hand class 2 is removed
  temporal_encoder: transformer # options: tcn, transformer
  head_temporal_encoder: transformer
  hand_temporal_encoder: tcn
  tcn_channels: [192, 192]
  tcn_kernel: 3
  tcn_dilations: [1, 2]
  tcn_dropout: 0.2
  hand_tcn_channels: [128, 128]
  hand_tcn_kernel: 3
  hand_tcn_dilations: [1, 2]
  hand_tcn_dropout: 0.2
  hand_attention_pool: true
  hand_attention_dropout: 0.1
  transformer:
    input_dim: null            # optional override; defaults to feature_dim
    num_layers: 2
    nhead: 4
    dim_feedforward: 512
    dropout: 0.1
    activation: relu
    use_positional_encoding: true
    pos_encoding: learned
    pre_norm: true
    max_len: 256
  freeze_backbone: false
  freeze_stages: -1  # -1: no freeze, 0: stem, 1: stem+layer1, 2: +layer2, 3: +layer3, 4: full backbone
  pretrained: true

# Loss
loss:
  type: cross_entropy  # options: cross_entropy, focal
  head_type: cross_entropy
  hand_type: focal
  class_weights: auto  # auto, none, or explicit list e.g. [1,1,1,1,1,1,1]
  focal_gamma: 2.0
  hand_focal_gamma: 2.0
  head_weight: 1.0
  hand_weight: 1.2

# Optimization
train:
  epochs: 30
  lr: 0.0008
  backbone_lr_scale: 0.05
  weight_decay: 0.0001
  grad_clip: 5.0
  device: auto
  save_dir: ./checkpoints/exp_roi_tcn_attn
  log_interval: 10
  log_dir: ./runs
  freeze_backbone_epochs: 5

# Evaluation
eval:
  checkpoint: ./checkpoints/exp_roi_tcn_attn/best.pt
  hand_unknown_threshold: 0.0
  hand_unknown_class: 4

# Inference
inference:
  hand_unknown_threshold: 0.0
  hand_unknown_class: 4
